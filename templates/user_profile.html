{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">

	<div class="row">
		<div class="col-sm-3 user-info">

			<h3 class="title"> {{ user.username }} </h3>

			{% if user.image %}
			<img height="200px" src="../static/images/{{ user.image }}" class="profile-img" /><br>
			{% endif %}

			<button class="btn" id="edit-btn">Edit profile</button>
			<div id="edit-form">
				<form action="/upload" enctype="multipart/form-data" method="POST">
				  Select image: <input type="file" name="photo"><br>
				  <input type="submit" class="btn btn-color">
				</form>
			</div><br>
			{% if friends %}
			<h5 class="title"> Following </h5>
				{% for friend in friends %}
				<form action="/friend" method="GET">
					<img src="../static/images/{{ friend.image }}" height="30px"style="border-radius:3px"></img>
					<input type="submit" class="btn" name="friend-profile" value="{{ friend.username }}">
					<input type="hidden" name="friend_id" value="{{ friend.user_id }}">
				</form>
				{% endfor %}
			{% endif %}
			<br>
			<h5> {{ num_friends }} followers </h5>
			<form action="/search-users" method="GET">
				<input type="search" name="search-friends" placeholder="Search users" id="search-friends">
			<input type="submit" class="btn btn-color" value="Submit">
			</form>
			<br>
		</div>

		<div class="col-sm-7 playlist-block">
			<div id="playlist-parent">
			{% if playlists %}
			<h3 class="title"> Playlists </h3>
			{% for playlist in playlists %}
			<p id="playlist-para" style="font-size:18px"> <button class="btn-color" id="plBtn{{ playlist.playlist_id }}" style="margin: 5px"> + </button> {{ playlist.title }}</p> 

				{% if playlist.tracks %}
				<div class="list-group" id="show-tracks-plBtn{{ playlist.playlist_id }}">
					{% for track in playlist.tracks %}
					<div class="list-group-item">
					<h4 class="list-group-item-heading"> {{ track.artist }}: {{ track.title }} </h4>
					<div id="track-div" class="list-group-item-text">
						<audio controls id="trackId{{ track.track_id }}" src="{{ track.audio }}">Your browser doesn't support the audio element.</audio><br>
						<button class="btn" id="re-trackId{{ track.track_id }}"><img src="static/rewind.svg" height="20px" alt="<< 10" /style="padding-right:5px">10</button><button class="btn" id="ff-trackId{{ track.track_id }}">30<img src="static/fast-forward.svg" height="20px" alt="30 >>" style="padding-left:5px"/></button>

					</div>
					<form action="/delete-track" method="POST">
						<input type="submit" class="btn" value="Delete"  id="delete-track">
						<input type="hidden" name="track_id" value="{{ track.track_id }}">
					</form>
					</div>
					
					{% endfor %}
				</div>
				{% endif %}

			{% endfor %}

			{% else %}
				<p> No playlists </p>
			{% endif %}
			</div>
			<button class="btn" id="show-playlist-form">Add Playlist</button>
			<div id="playlist-form">
				<form action="/add-playlist" method='post'>
					<input type="text" name="playlist-name" placeholder="Playlist name" required> <input type='submit' class="btn btn-color" id='new-playlist' value="Create"/>
				</form>
			</div>
			<br>
			<br>
		</div>
	</div>

</div>


<script>

$(document).ready(function () {
	$("[id*=show-tracks]").hide();
	$("p [id*=plBtn]").on('click', function() {
		let btn = $(this).html();
		if (btn == "-") {
			$(this).html("+");
		}
		else {
			$(this).html("-");
		}
		let id = $(this).attr("id");
		let thisDiv = "#show-tracks-" + id;
		$(thisDiv).toggle();
		// $(this).html("-");
	});

});


$(document).ready(function () {
	// $("#track")[0].currentTime = 10;
	// console.log("Storage" + ": " + localStorage.getItem(audioSrc));
	try {
		$("[id*=trackId]")[0].currentTime = localStorage.getItem(audioSrc);
	}
	catch (err) {
		$("[id*=trackId]")[0].currentTime = 10;
	}
	$(".audio").on('click', function() {
		let cTime = $(this).currentTime;
		console.log(cTime);
		let audioSrc = $(this).attr("src");
		localStorage.setItem(audioSrc, cTime);

		let savedTime = localStorage.getItem(audioSrc);
		// localStorage.removeItem("track-item");
		// console.log("Storage" + ": " + savedTime);
		let trackId = $(this).attr("id");
		console.log(trackId);
	});
	$("[id*=re]").on('click', function() {
		let reId = $(this).attr("id");
		let trackId = reId.substring(3);
		// console.log(trackId);
		$("#" + trackId)[0].currentTime -= 10;
	});
	$("[id*=ff]").on('click', function() {
		let ffId = $(this).attr("id");
		let trackId = ffId.substring(3);
		// console.log(trackId);
		$("#" + trackId)[0].currentTime += 30;
	});
});


$(document).ready(function () {
	$("#edit-form").hide();
	$("#edit-btn").on('click', function() {
		$("#edit-form").toggle();
	});
});


$(document).ready(function () {
	$("#playlist-form").hide();
	$("#show-playlist-form").on('click', function() {
		$("#playlist-form").toggle();
	});
});

</script>


{% endblock %}